# üåÄxüêµ Replit Codemirror 6 Template
##### By [CodingCactus](https://replit.com/@CodingCactus)

![Replit Codemirror 6 Template Logo](https://cc.repl.co/QmQmJ7.png)

[Codemirror 6](https://codemirror.net/6) is a mobile friendly, easy to use (with this template), in-browser code editor. Recently it's been looked at with a negative opinion due to Replit's [infamous instabilities](https://blog.replit.com/qlty-szn) during its initial codemirror rollout. However, in reality, it's actually really quite good. It can make, what would seem complex, tasks such as custom syntax highlighting, autocomplete, keyboard shortcuts, code linting and more, almost trivial.

However, there are disadvantages with it. One of the main points being the [documentation](https://codemirror.net/6/docs/ref/). It leaves a lot to be desired, especially in terms of beginner friendliness. That is something that this template hopes to greatly make up for. Replit is all about [lowering the bar](https://blog.replit.com/operating-principles) to being able to program, and so, with this template, anyone should be able to have some fun making their own fancy code editors.

## üì¶ Out of the box
Straight off the bat you'll start with:
- A functioning editor
- A web server set up to host your editor
- Rollup configuration ready for you to bundle your files for use in the browser
- My silly fake language for example purposes, complete with:
  - Autocomplete
  - Automatic indentation
  - Code folding
- Three editor themes (light, green (üåµ!), dark)
- Download button to save your code to a local file
- Upload button to open a local file in the editor
- A simple `.gitignore` file ready for you to use version control with your project (recommended)

## üó∫Ô∏è Finding your way around
The project structure might be a little overwhelming at first, so here's a simple guide to what's where:
- `server.js` This is your webserver set up to host your editor. You probably won't ever need to touch that, unless you take this project further than just a simple editor (if you do, let me know, I'd love to see what you make!)
- `server/` This folder is for any of your files related directly to the webpage surrounding your editor (your HTML and CSS files)
  - `server/index.html` This is the main page of your editor. You can see the editor div and the codemirror script in there
  - `server/editor.css` This is where your main styling for your editor goes. Things like fonts and layouts go in here
- `codemirror6/` This is the folder for anything to do with interacting with your codemirror editor
  - `codemirror6/myLanguage/` In this folder you create your custom language package
    - `codemirror6/myLanguage/index.ts` This file is where you work with your parser. Things like automatic indention, code folding and autocomplete go in here
    - `codemirror6/myLanguage/syntax.grammar` This file is where you write your language grammar to generate the parser
  - `codemirror6/editor/` In this folder are all your files related to working with the editor
    - `codemirror6/editor/editor.js` This is the entry point for you codemirror editor. The editor is defined and initialized in here
    - `codemirror/editor/extensions/` This is the folder where all the extensions are handled
    - `codemirror6/editor/*/` You can add as many folders as you want in the `editor/` folder. Each should should be a sensibly named category for ease of navigation (e.g. a folder called 'files' for file handling related code)
- `dist/` This folder contains the files generated by the rollup command. You'll become familiar with that as you start developing. Don't change these files, they'll get overwritten on every rollup
- `rollup.config.js` This is the rollup configuration file, all ready for you to use when you get to using the rollup command. You probably won't need to touch this unless you're adding extra functionality to your editor
- `tsconfig.json` Self explanatory, just configures the typescript setup. You won't need this if you aren't making your own language parser
- `.gitignore` Just a gitignore file, add file names in there that you don't want to be included in version control

## üß© The Basics
Things to know as you get started:
- You will need a basic understanding of JavaScript to move forward with this template, but don't worry, you don't need to be an expert!
- Some CSS and HTML knowledge would help, but you can work it out quite easily
- If you're looking into writing your own language package, a basic understanding of Regular Expressions wouldn't hurt, as they crop up in a few places there
- You'll need to run either of these 2 commands in the shell when you make changes to your editor (they do the same thing so choose your favourite!):
  - `npx rollup -c`
  - `npm run rollup`
- Your editor is made up of extensions. Each extension serves a certain functionality of your editor. For example, you have: theme extensions, a keymap extension, a language package extension etc.

## ‚öíÔ∏è Adding to your Editor
There are 2 main ways to add functionality to your editor:
1. Directly changing its behaviour through extensions
2. Adding external interactions such as clicking a button to change theme or download the editor's content

### Extensions
When adding new extensions to your editor you should add your code in the `codemirror6/editor/extensions/` folder to keep it organised. If you are adding an extension from a package, add it through the package manager in the sidebar, then add it to the imports in `codemirror6/editor/extensions/base.js`, and then finally to the `extensions` array in there. Information on what function to import from the package should be available somewhere in that package's documentation.

If you want to add your own extensions, such as themes, also do this in the extensions folder, but it is probably a good idea to add them in a separate file to keep the `extensions.js` file nice and clean. Take a look at how the keyboard shortcuts are implemented in this template (`codemirror6/editor/extensions/shortcuts.js`) to get started!

### External Interactions
As well as your extensions, it will also be very common (perhaps more common?) for you to want to do something with your editor after a user has interacted with an external-to-the-editor part of the website. For example, clicking a button to download a file. You can check that out in `codemirror6/editor/files/download.js`. When adding external interactions, you should group them in a folder inside `codemirror6/editor/` with a suitable name. For example, the template includes a `files/` folder which has the code which handles the upload and download buttons. If you wanted to add something unrelated to files, you would add a new folder appropriately named. Once you've added your new files, if they don't get imported anywhere else, you'll need to import them in `codemirror6/editor/editor.js` so that they actually get rolled up so they can be used.

#### Useful snippets:
- **Get the editor's content**: `editor.state.doc.toString()`
- **Edit the editor's content**: `editor.update([editor.state.update({ changes: { from: startIndex, to: endIndex, insert: content } })])`
- **Overwrite the entirety of the editor's content**: ` editor.update([editor.state.update({ changes: { from: 0, to: editor.state.doc.length, insert: content } })])`
- **Change the editor's extensions**: `editor.dispatch({ effects: /* reconfiguration function */ })` see `codemirror6/editor/extensions/themes.js` for changing the theme extension

## üìú Making a Language Package
One of, I think, the coolest things about codemirror is how easy it is to implement fancy language related things such as syntax highlighting. As you've already read, this template comes with a weird language design I came up with, to demonstrate how simple it is to make something rather complicated using codemirror. Codemirror 6 uses a package called [Lezer](https://lezer.codemirror.net/docs/guide/) to make your language parser by writing grammar for your language. The syntax is pretty straight forward, I recommend you start with what's in `codemirror6/myLanguage/start.grammar` and use `codemirror6/myLanguage/syntax.grammar` as a reference on where to go from there.

#### What to do:
- First of all, rename the `codemirror6/myLanguage/` folder to whatever your language is called
> ‚ÑπÔ∏è Throughout this guide, that folder will still be named as `myLanguage`, but you should be aware that it references whatever you renamed that folder to
- Then edit the following to also the name of your language:
  - `codemirror6/myLanguage/index.ts` lines 8, 44, 46, 47
  - `codemirror6/editor/extensions/base.js` lines 7, 16
- Write your grammar in `codemirror6/myLanguage/syntax.grammar`, using the current content and the [documentation](https://lezer.codemirror.net/docs/guide/) as a guide. You can also look at [published language packages](https://github.com/orgs/codemirror/repositories?q=lang-) to see how they do their grammar.
- Next, head to `codemirror6/myLanguage/index.ts` to set language dependant features of your editor. In this template, you start with automatic indentation, code folding, syntax highlighting and autocomplete
  - **Indentation**: In this template, the indentation logic is: if a line is detected to be a part of an `Application` (defined in your grammar file), it will be automatically indented. Unless, it matches the regular expression defined on line 6 of `codemirror6/myLanguage/index.ts`. The line will be automatically un-indented after you type something which matches that regular expression.
  - **Code Folding**: The code folding is very simple, you can fold any `Application`s that are found
  - **Syntax Highlighting**: Lines 20-35 in `codemirror6/myLanguage/index.ts` are used to associate the tokens (defined in your grammar file) with style tags, in order for you to create custom syntax highlighting themes. While the tags are associated in `index.ts`, the actual styling for each tag belongs in `codemirror6/editor/extensions/themes.js` so you can have different colours for each theme. Lines 39-54 in `themes.js` are an example of how you work with those tags to assign styles to them.
  - **Autocomplete**: This template *also* comes with a simple autocomplete algorithm for you to use
    - **Static Suggestions**: In `codemirror6/myLanguage/index.ts`, line 60 defines the autocomplete suggestions applicable to every scenario. This includes, keywords, inbuilt functions etc.
    - **Variable Suggestions**: Lines 84-100 of `index.ts` finds all the nodes in the syntax tree of your editor's current content which are `Identifier` tokens. It adds each one to the list of possible autocomplete suggestions (not taking into account any scoping however, so you will have to add that functionality yourself depending on what scoping system your language has). The list of suggestions is then returned, allowing codemirror to do the rest of the work and decide which suggestions to show the user.
> ‚ÑπÔ∏è Of course you don't have to write your own language package! Many popular languages already have language packages ready for you to work with, e.g. [Rust](https://github.com/codemirror/lang-rust), [Python](https://github.com/codemirror/lang-python) and [JS](https://github.com/codemirror/lang-javascript)
>
> [View More Here](https://github.com/orgs/codemirror/repositories?q=lang-)

## üí° Ideas to Add to Your Editor
Things I would like to see people do, to add to this template:
- Add code linting to their editor
- Integrate the editor with some sort of code evaluation service
- Support crazy things like AI autocompletion and code explanation
- Create a playground for a brand new language that you have made


## üèóÔ∏è Projects Using this Template
- [Pseudonaja](https://pseudonaja.repl.co) ([Source](https://replit.com/@pseudonaja/pseudonaja)) - This is a project that I am working on with a few members of my CS class. It takes this template quite a lot further, showing some of its potential. Pseudonaja is intended to be (when completed) a sort of in-browser IDE for the PseudoCode specification that the [CIE exam board](https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-international-as-and-a-level-computer-science-9618/) (the exam board my school uses for CS) has come up with. And therefore, it contains extra advanced features on top of this template, such as: a virtual file system üòÆ, projects (groups of files) which can be downloaded and uploaded, functionality to restore your previous session, and more. It's a good place to look if are wondering what the next step you want to take is (and how to take that step).
> ‚ÑπÔ∏è If you go on to make something with this template, please let me know, I'd by happy to add it here!

## üìö Further Reading
To take this template further and to deepen your understanding of what's happening, here are some handy links:
- **Why Codemirror?**: https://blog.replit.com/codemirror
- **Documentation**: https://codemirror.net/6/docs/
- **Examples**: https://codemirror.net/6/examples/
- **Lezer Documentation**: https://lezer.codemirror.net/docs/
- **Existing Language Packages**: https://github.com/orgs/codemirror/repositories?q=lang-


###### P.S. If someone wants to implement my weird language idea, please let me know so I can get involved ü§£